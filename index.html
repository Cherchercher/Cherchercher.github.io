<!doctype html>
<html>
<head>
    <!--<link rel="stylesheet" href="/bootstrap/bootstrap.min.css">-->
    <!--<script src="/jquery/jquery.min.js"></script>-->
    <!--<script src="/bootstrap/bootstrap.min.js"></script>-->
    <!--<script src="script.js"></script>-->

    <meta name="viewport" content="initial-scale=1, user-scalable=no">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <!--<link rel="stylesheet" href="style.css">-->

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <style>


    </style>
</head>
<script>
        var student_array=[]; // array to hold student data
        var grade_array=[]; // array to hold student grades
        var i=student_array.length-1;

        function loadData()
        {
            console.log ('load data called');
            $.ajax(
            {
                dataType: 'json',
                url: 'http://s-apis.learningfuze.com/sgt1/get',
                type: 'GET',
                success: function(response) // api sucess handler
                {
                    console.log ('loaded', response);
                    student_array = response.data;
                },
                error : function(xhr, thrownError) // api failure handler
                {
                    alert (xhr.status+' is the status of the alert');
                    alert (thrownError+' in getting information from the server');
                }
            })
        }
//        student_array = [{"name":"Chang","course":"ETR","grade":88},{"name":"Frank","course":"gf","grade":55}]; // used for testing
        function add_student()
        {
            var student={ name:"",
                course:"",
                grade: ""
             };

            var name=$('#studentName').val();
            var grade=$('#studentGrade').val();
            var course=$('#course').val();
            student.name=name;
            student.grade=parseFloat(grade);
            student.course=course;
            student_array.push(student);
            grade_array.push(student.grade);
            console.log(student_array);

        }
        var sample_student_array = [
            {name: 'Todd', course:'Algebra', grade:80},
            {name: 'Cher', course:'Art History', grade: 81}
        ];
        function list_students() {
           var list = $("#tbody");
            list.html('');            //create column header

            for (var j = 0; j < student_array.length; j++) // for loop to add student data to dom
            {
                var student = add_one_student(student_array[j]);
                student.attr('student_index',j);
                list.append(student);
//                $.each(grade_array,function(){sum+=parseFloat(this) || 0;});
//                console.log(sum);
//                var avg= $(".avgGrade");
//                avg.html('');
//                var thisavg= $("<div>",{
//                    'text': sum/student_array.length
//                });
//                list.append(thisname, thiscourse, thisgrade);
//                console.log(thisavg);
//                avg.append(thisavg);
            }
            display_average_grade();
        }
        function add_one_student(student){ // takes student_array[j] element as input, passed in student_array[j] from for loop
            var student_row = $("<tr>").addClass('student_row');
            var student_name = $("<td>").addClass('student_name col-xs-3').text(student.name);
            var student_course = $("<td>").addClass('student_course col-xs-3').text(student.course);
            var student_grade = $("<td>").addClass('student_grade col-xs-3').text(student.grade);
            var delete_button_td = $("<td>").addClass('delete_col col-xs-3');
            var delete_button = $('<button>').attr('type','button').addClass('btn btn-danger delBtn').text('Delete');
            delete_button.click(function()
            {
                console.log ('testing delete button',this);
                removeStudent(this);
            });
            delete_button_td.append(delete_button);

            student_row.append(student_name, student_course, student_grade,delete_button_td);
            return student_row;
        }

        function calculate_average_grade()
        {
            var average=0;
            var sum=0;
            for (i=0; i < student_array.length; i++)
            {
                sum = sum + parseFloat(student_array[i].grade);
            }
            average= sum / student_array.length;
            return average;
        }
        function display_average_grade(){
            var average_grade = calculate_average_grade();
            $('.avgGrade').text(average_grade);
        }
        function cancel_student(){
            student_array=[];
             var list = $("#tbody");
            list.empty();

        }

        function reset_student(){
           location.reload();
        }

        $("#reset").click(function() {
            reset_student();
            console.log("reset button clicked")
        });
        function removeStudent(targetElement) // runs on clicking delete button on student row
        {
            var studentRow = $(targetElement).parents('.student_row');
            var row_delete = studentRow.attr('student_index');
            console.log (row_delete, 'via remove student function, student array=', student_array);
            delete student_array[row_delete]; // removes student from array
            console.log (student_array,'is student array');
            studentRow.remove();
        }

     $(document).ready(function()
    {
        loadData();
        list_students();
        $("#add").click(function () {
                add_student();
                list_students();
//                cancel_student();
                console.log("add button clicked");
            });

        $("#cancel").click(function() { // click handler for cancel button- clears input boxes
                cancel_student();
                console.log("cancel button clicked");
                 });

    });



</script>
<body>
<div class="container">
    <div class="row headerRow">
        <div class="col-xs-0 col-md-12 onMobile"> <!-- only show this element when the is on mobile -->
            <div class="col-xs-0 col-md-12 onMobile onMobileGradeAverageHeader">
                <h3><b>Student Grade Table</b></h3>
            </div>
            <div class="col-xs-0 col-md-12 pull-right onMobile onmobileGradeAverageNumber"><h3><small>
                Grade Average : <span class="label label-default avgGrade"><span class="avgGradeSpan">0</span></span></small></h3>

            </div>
        </div>


            <div class="col-xs-0 col-md-12 nonMobile"> <!-- only show this element when the isnt on mobile -->
                <div class="col-xs-0 col-md-12 nonMobile nonMobileGradeAverageHeader">
                    <h1>Student Grade Table</h1>
                </div>
                <div class="col-xs-0 col-md-12 nonMobile nonMobileGradeAverageNumber"><h2><small>
                   Grade Average : <span class="label label-default avgGrade"><span class="avgGradeSpan">0</span></span></small></h2>

                </div>
            </div>



    </div>
    <div class="student-add-form">
        <h3>Add Student</h3>

        <div class="input-group">
            <span class="input-group-addon">
                <i class="fa fa-search glyphicon glyphicon-user"></i>
            </span>
            <input type="text" class="form-control" name="studentName" id="studentName" placeholder="Student Name"/>
        </div>

        <label class="control-label" for=""></label> <!-- kinda hacky, time constraint-->
        <div class="input-group">
            <span class="input-group-addon">
                <i class="fa fa-search glyphicon glyphicon-list-alt"></i>
            </span>
            <input type="text" class="form-control" name="course" id="course" placeholder="Student Course"/>
        </div>


        <!--<div class="">-->
            <!--<span class="">-->
                <!--<span class="glyphicon"></span>-->
            <!--</span>-->
            <!--<input type="text" class="form-control" name="course" id="course"-->
                   <!--placeholder="Student Course">-->
        <!--</div>-->
        <label class="control-label" for=""></label><!-- kinda hacky, time constraint-->
        <div class="input-group">

            <span class="input-group-addon">
                <i class="fa fa-search glyphicon glyphicon-user"></i>
            </span>
            <input type="text" class="form-control" name="studentGrade" id="studentGrade"
                   placeholder="Student Grade">
        </div>

        <button type="button" class="btn btn-success" onclick="" id="add" >Add</button>
        <button type="button" class="btn btn-default" onclick="" id="cancel">Cancel</button>
        <button type="button" class="btn btn-default" onclick="" id="reset">Reset</button>

    </div>
    <div class="student-list-container">
        <table class="student-list">
            <thead>
                <tr>
                    <td class="col-xs-3">Student Name</td>
                    <td class="col-xs-3">Student Course</td>
                    <td class="col-xs-3">Student Grade</td>
                    <td class="col-xs-3">Delete</td>
                </tr>
            </thead>
            <tbody id="tbody">
            </tbody>
        </table>
    </div>
</div>
</body>
</html>

<style>
    @media screen and (min-width: 360px)
    {
        .onMobile
        {
            display: none;
        }
    }
    @media screen and (max-width: 360px)
    {
        .nonMobile
        {
            display: none;
        }
    }
</style>

